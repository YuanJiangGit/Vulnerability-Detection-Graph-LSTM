# -*- coding: utf-8 -*-
# @Time    : 3/14/22 10:12 PM
# @Author  : YuanJiang
# @Site    : 
# @File    : FileProcess.py
# @Software: PyCharm

import os, shutil
import pickle



def mycopy(srcpath,dstpath):
    if not os.path.exists(srcpath):
        print "srcpath not exist!"
    for root,dirs,files in os.walk(srcpath,True):
        for eachfile in files:
            src_file_path = os.path.join(root, eachfile)
            src_dir_name = os.path.basename(os.path.dirname(src_file_path))
            tgt_dir_path = os.path.join(dstpath,src_dir_name)
            if not os.path.exists(tgt_dir_path):
                os.mkdir(tgt_dir_path)
            shutil.copy(src_file_path,tgt_dir_path)


def merge_slice_points(srcpath,dstpath):
    if not os.path.exists(srcpath):
        print "srcpath not exist!"
    for root,dirs,files in os.walk(srcpath,True):
        for eachfile in files:
            src_file_path = os.path.join(root, eachfile)
            tgt_dir_path = dstpath

            tgt_file_path = os.path.join(tgt_dir_path,eachfile)
            if os.path.exists(tgt_file_path):
                with open(tgt_file_path, 'rb') as f:
                    _dict_1 = pickle.load(f)
                with open(src_file_path,'rb') as f:
                    _dict_2 = pickle.load(f)
                # merge two dict
                _dict_3 = _dict_1.copy()
                _dict_3.update(_dict_2)

                with open(tgt_file_path,'wb') as f:
                    pickle.dump(_dict_3, f, True)
            else:
                shutil.copy(src_file_path,tgt_dir_path)



if __name__ == '__main__':
    # dict_call
    # src_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/shixiong/sarddict"
    # dst_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/Implementation/resources/dict_call2cfgNodeID_funcID"
    # mycopy(src_path, dst_path)

    # pdg
    # src_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/shixiong/sardpdg"
    # dst_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/Implementation/resources/pdg_db"
    # mycopy(src_path, dst_path)

    # slice key points
    # src_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/shixiong/sardpoint"
    # dst_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/Implementation/resources/sardpoint"
    # merge_slice_points(src_path, dst_path)

    # source file
    src_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/Program data/SARD+NVD"
    dst_path = "/home/sse/project/Vul/State-of-the-art/SySeVR-master/Program data/Code"
    mycopy(src_path, dst_path)
